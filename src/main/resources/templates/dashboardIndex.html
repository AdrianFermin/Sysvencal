<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Sysvencal</title>
        <meta charset="UTF-8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="shortcut icon" href="http://drive.google.com/uc?export=view&id=1tLEbLI6OT8zKJa8GAGWg6etc13GfTKg_"/>
        <script src="https://kit.fontawesome.com/32842ccf5f.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    </head>
    <body>

        <style>

            .nav-pills li a:hover {
                background-color: blue;
            }

            ::-webkit-scrollbar {
                width: 7px;
            }

            ::-webkit-scrollbar-thumb {
                background: #6c757d;
                border-radius: 10px;
            }

        </style>

        <div th:fragment="header" class="container-fluid bg-dark bg-gradient shadow text-white sticky-top">
            <div class="row">
                <div class="col-md-4">
                    <a type="button" th:href="@{/dashboard}" class="text-decoration-none text-white">
                        <div class="d-flex flex-row ms-3 mb-2">
                            <img src="http://drive.google.com/uc?export=view&id=1tLEbLI6OT8zKJa8GAGWg6etc13GfTKg_" width="75px" height="75px" alt="Logo"/>
                            <h1 class="mt-3 ms-1">Sysvencal</h1>
                        </div>
                    </a>
                </div>
                <div class="col-md-7"></div>
                <div class="col-md-1">
                    <div class="d-flex flex-row-reverse">
                        <div class="me-3 mt-4">
                            <button type="button" class="btn" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                                <i class="fa-solid fa-circle-user fa-2xl" style="color: #c2c2c2;"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a th:href="@{/}" class="text-decoration-none">
                                    <div class="d-flex flex-row text-secondary">
                                        <i class="fa-solid fa-shop fa-xl mt-3 ms-2" style="color: #757575; margin-top: 1px;"></i><h5 class="ms-2" style="margin-top: 2px">Tienda</h5>
                                    </div>
                                </a>
                                <hr class="dropdown-divider">
                                <a th:href="@{/pedidos}" class="text-decoration-none">
                                    <div class="d-flex flex-row text-secondary">
                                        <i class="fa-solid fa-receipt fa-xl mt-3 ms-2" style="color: #757575; margin-top: 1px;"></i><h5 class="ms-2" style="margin-top: 2px">Mis Pedidos</h5>
                                    </div>
                                </a>
                                <hr class="dropdown-divider">
                                <a th:href="@{/logout}" class="text-decoration-none">
                                    <div class="d-flex flex-row text-secondary mt-2">
                                        <i class="fa-solid fa-power-off fa-xl mt-3 ms-2" style="color: #757575; margin-top: 1px;"></i><h5 class="ms-2" style="margin-top: 2px">Log out</h5>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row flex-nowrap">
                <div th:fragment="sidebar" class="bg-dark col-auto col-md-3 col-lg-3 min-vh-100">
                    <div class="bg-dark p-2">
                        <a class="d-flex text-decoration-none mt-1 align-items-center text-white">
                            <i class="fs-4 fa fa-bars"></i><span class="ms-3 fs-3 d-none d-sm-inline">Menu</span>
                        </a>
                        <ul class="nav nav-pills flex-column mt-2">
                            <li class="nav-item py-2 py-sm-0">
                                <a id="dashboard" th:href="@{/dashboard}" class="nav-link text-white active a">
                                    <i class="fs-4 fa fa-chart-line"></i><span class="ms-3 fs-3 d-none d-sm-inline">Dashboard</span>
                                </a>
                            </li>
                            <li class="nav-item py-2 py-sm-0">
                                <a id="productos" th:href="@{/dashboard/productos}" class="nav-link text-white a">
                                    <i class="fs-4 fa-solid fa-box-archive"></i><span class="ms-3 fs-3 d-none d-sm-inline">Productos</span>
                                </a>
                            </li>
                            <li class="nav-item py-2 py-sm-0">
                                <a id="usuarios" th:href="@{/dashboard/usuarios}" class="nav-link text-white a">
                                    <i class="fs-4 fa-solid fa-user"></i><span class="ms-3 fs-3 d-none d-sm-inline">Usuarios</span>
                                </a>
                            </li>
                            <li class="nav-item py-2 py-sm-0">
                                <a id="carritos" th:href="@{/dashboard/carritos}" class="nav-link text-white a">
                                    <i class="fs-4 fa-solid fa-cart-shopping"></i><span class="ms-3 fs-3 d-none d-sm-inline">Carritos</span>
                                </a>
                            </li>
                            <li class="nav-item py-2 py-sm-0">
                                <a id="facturas" th:href="@{/dashboard/facturas}" class="nav-link text-white a">
                                    <i class="fs-4 fa-solid fa-receipt"></i><span class="ms-3 fs-3 d-none d-sm-inline">Facturas</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="row ms-5 mt-5">
                        <div class="col-md-3">
                            <div class="container shadow border border-2 border-success text-success rounded">
                                <div class="my-3">
                                    <i class="fs-4 fa-solid fa-box-archive"></i><span class="ms-3 fs-4 d-none d-sm-inline"><strong>Productos</strong></span>
                                    <br>
                                    <span th:text="${'Cantidad de Productos: ' + productos}" class="mb-5 fs-6 d-none d-sm-inline"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="container shadow border border-2 border-warning text-warning rounded">
                                <div class="my-3">
                                    <i class="fs-4 fa-solid fa-user"></i><span class="ms-3 fs-4 d-none d-sm-inline"><strong>Usuarios</strong></span>
                                    <br>
                                    <span th:text="${'Cantidad de Usuarios: ' + usuarios}" class="mb-5 fs-6 d-none d-sm-inline"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="container shadow border border-2 border-danger text-danger rounded">
                                <div class="my-3">
                                    <i class="fs-4 fa-solid fa-cart-shopping"></i><span class="ms-3 fs-4 d-none d-sm-inline"><strong>Carritos</strong></span>
                                    <br>
                                    <span th:text="${'Cantidad de Carritos: ' + carritos}" class="mb-5 fs-6 d-none d-sm-inline"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="container shadow border border-2 border-primary text-primary rounded">
                                <div class="my-3">
                                    <i class="fs-4 fa-solid fa-receipt"></i><span class="ms-3 fs-4 d-none d-sm-inline"><strong>Facturas</strong></span>
                                    <br>
                                    <span th:text="${'Cantidad de Facturas: ' + facturas.size}" class="mb-5 fs-6 d-none d-sm-inline"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row ms-5 mt-5">
                        <div class="container rounded border border-light rounded shadow">
                            <div class="row mx-2 my-3">
                                <h2><i class="fa-solid fa-chart-simple"></i> Estadisticas</h2>
                                <hr/>
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="container rounded border border-light rounded shadow mb-3 text-center">
                                        <h3 class="my-2 fw-bold">Producto mas Vendido</h3>
                                        <img class="rounded-circle shadow-lg mb-2" th:src="${portada.imagen}" width="250px" height="250px"/>
                                        <h4  class="mb-3" th:text="${pVentas.nombre}"></h4>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="container rounded border border-light rounded shadow mb-4">
                                        <div class="d-flex flex-row">
                                            <h3 class="my-2 fw-bold">Cantidad Vendida:</h3>
                                            <h3 class=" ms-2 fs-3" th:text="${contP}" style="margin-top: 8px;"></h3>
                                        </div>
                                        <div class="d-flex flex-row mb-2">
                                            <h3 class="my-2 fw-bold">Cantidad Restante:</h3>
                                            <h3 class=" ms-2 fs-3" th:text="${pVentas.stock}" style="margin-top: 8px;"></h3>
                                        </div>
                                    </div>
                                    <div class="container rounded border border-light rounded shadow mb-3">
                                        <h3 class="my-2 fw-bold">Descripcion:</h3>
                                        <p class="fs-6 mb-5" th:text="${pVentas.descripcion}"></p>
                                    </div>
                                </div>
                            </div>
                            <hr/>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="container rounded border border-light rounded shadow mb-3 text-center">
                                        <h3 class="my-2 fw-bold">Mayor Comprador</h3>
                                        <img class="rounded-circle shadow-lg mb-2" src="http://drive.google.com/uc?export=view&id=1c7kzyZ1IJU-rrYBTjHLc4lN8TB6wGWC-" width="250px" height="250px"/>
                                        <h4 class="mb-3" th:text="${uVentas.nombre}"></h4>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="container rounded border border-light rounded shadow mb-4">
                                        <div class="d-flex flex-row">
                                            <h3 class="my-2 fw-bold">Cantidad de Compras:</h3>
                                            <h3 class=" ms-2 fs-3" th:text="${contU}" style="margin-top: 8px;"></h3>
                                        </div>
                                        <div class="d-flex flex-row mb-2">
                                            <h3 class="my-2 fw-bold">Cantidad de Ingresos:</h3>
                                            <h3 class=" ms-2 fs-3" th:text="${'$' + ingresos + ' USD'}" style="margin-top: 8px;"></h3>
                                        </div>
                                    </div>
                                    <div class="container rounded border border-light rounded shadow mb-3">
                                        <h3 class="my-2 fw-bold">Compras:</h3>
                                        <div class="overflow-auto"  style="height: 170px">
                                            <table class="table table-striped table-hover rounded">
                                                <thead>
                                                    <tr>
                                                        <th>Fecha</th>
                                                        <th>Usuario</th>
                                                        <th>Costo</th>
                                                        <th>Detalles</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                <div th:each="factura : ${facturas}">
                                                    <tr th:if="${factura.usuario.idUsuario == uVentas.idUsuario}">
                                                        <td th:text="${factura.fecha}"></td>
                                                        <td th:text="${factura.usuario.nombre}"></td>
                                                        <td th:text="${'$' + (factura.costo + factura.itbis) + ' USD'}"></td>
                                                        <td><button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#detalleFacturaModal" th:attr="data-bs-target=${'#detalleFactura' + factura.idFactura}">Detalles</button></td>
                                                    </tr>
                                                </div>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div th:each="factura : ${facturas}">
                                            <section th:replace="dsModals :: detalleFacturaModal"></section>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script th:replace="scripts :: scripts"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    </body>
</html>
